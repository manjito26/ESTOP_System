<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Report - ESTOP System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    {% extends "base.html" %}
    {% block content %}

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Report #{{ report.id }}</h2>
                    <div>
                        {% if current_user and current_user.role in ['supervisor', 'admin'] %}
                        <a href="{{ url_for('edit_report', report_id=report.id) }}" class="btn btn-warning me-2">Edit Report</a>
                        {% endif %}
                        <a href="{{ url_for('reports') }}" class="btn btn-secondary">Back to Reports</a>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h5>{{ report.title }}</h5>
                        <div class="mt-2">
                            <span class="badge 
                                {% if report.severity == 'critical' %}bg-danger
                                {% elif report.severity == 'high' %}bg-warning text-dark
                                {% elif report.severity == 'medium' %}bg-info
                                {% else %}bg-success{% endif %} me-2">
                                {{ report.severity|title }}
                            </span>
                            <span class="badge 
                                {% if report.status == 'open' %}bg-danger
                                {% elif report.status == 'investigating' %}bg-warning text-dark
                                {% elif report.status == 'resolved' %}bg-info
                                {% else %}bg-success{% endif %}">
                                {{ report.status|title }}
                            </span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Incident Details</h6>
                                <table class="table table-sm">
                                    <tr>
                                        <td><strong>Date:</strong></td>
                                        <td>{{ report.incident_date.strftime('%Y-%m-%d %H:%M') if report.incident_date else 'N/A' }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Location:</strong></td>
                                        <td>{{ report.location }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Equipment:</strong></td>
                                        <td>{{ report.equipment_involved or 'Not specified' }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Witnesses:</strong></td>
                                        <td>{{ report.witnesses or 'None listed' }}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <h6>Assignment Details</h6>
                                <table class="table table-sm">
                                    <tr>
                                        <td><strong>Reported By:</strong></td>
                                        <td>{{ report.reporter_first }} {{ report.reporter_last }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Assigned To:</strong></td>
                                        <td>
                                            {% if report.assignee_first %}
                                                {{ report.assignee_first }} {{ report.assignee_last }}
                                            {% else %}
                                                <span class="text-muted">Unassigned</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Created:</strong></td>
                                        <td>{{ report.created_at.strftime('%Y-%m-%d %H:%M') if report.created_at else 'N/A' }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Last Modified:</strong></td>
                                        <td>{{ report.modified_at.strftime('%Y-%m-%d %H:%M') if report.modified_at else 'N/A' }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="mb-4">
                            <h6>Description</h6>
                            <div class="border rounded p-3 bg-light">
                                {{ report.description | replace('\n', '<br>')|safe }}
                            </div>
                        </div>
                        
                        {% if report.corrective_actions %}
                        <div class="mb-4">
                            <h6>Corrective Actions</h6>
                            <div class="border rounded p-3 bg-light">
                                {{ report.corrective_actions | replace('\n', '<br>')|safe }}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if report.modified_by %}
                        <div class="text-muted small">
                            Last modified by: {{ report.modified_by }}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    {% endblock %}
</body>
</html>